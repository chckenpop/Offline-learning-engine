<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bright Study - Offline Learning</title>
    <link rel="stylesheet" href="styles.css?v=4">
</head>

<body>
    <div id="network-alert">WARNING: No internet connection. Online features are unavailable.</div>
    <div id="speed-test-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <div class="spinner"></div>
            <h3>Testing Network Speed...</h3>
            <p>Optimizing your experience based on connectivity.</p>
        </div>
    </div>

    <div id="gateway">
        <div class="gateway-card">
            <div class="logo-mark">BRIGHT STUDY</div>
            <h1>Pick your Learning Mode</h1>
            <p>We've detected your connection quality to help you decide.</p>

            <div id="gateway-detection" class="detection-panel">
                <div class="spinner-small" id="gateway-spinner"></div>
                <div id="gateway-speed-msg">Auto-detecting network speed...</div>
                <button class="retest-btn" onclick="app.runSpeedTest(true)" id="retest-btn"
                    style="display:none">Retest</button>
            </div>

            <div class="gateway-actions">
                <button class="gateway-btn" id="offline-btn" onclick="app.setMode('offline')">Study Offline</button>
                <button class="gateway-btn primary" id="online-btn" onclick="app.setMode('online')">Study
                    Online</button>
            </div>
            <div class="gateway-note">Online mode enables high-quality videos and cloud updates.</div>
        </div>
    </div>

    <div id="auth-gateway"
        style="display: none; position: fixed; inset: 0; background: var(--bg); z-index: 100; align-items: center; justify-content: center;">
        <div class="gateway-card" style="width: 100%; max-width: 400px; padding: 2rem;">
            <div class="logo-mark">BRIGHT STUDY</div>
            <h2 id="auth-title" style="margin-bottom: 1rem; font-size: 1.5rem;">Login</h2>
            <div id="auth-error"
                style="display: none; color: var(--danger); font-size: 0.85rem; margin-bottom: 1rem; padding: 0.5rem; background: rgba(239, 68, 68, 0.1); border-radius: 6px;">
            </div>

            <form id="auth-form" onsubmit="app.handleAuthSubmit(event)" style="text-align: left;">
                <div id="signup-fields" style="display: none;">
                    <div style="margin-bottom: 1rem;">
                        <label
                            style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem; color: var(--text-dim);">Full
                            Name</label>
                        <input type="text" id="auth-name" placeholder="John Doe"
                            style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text-main);">
                    </div>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <div style="flex: 1;">
                            <label
                                style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem; color: var(--text-dim);">Age</label>
                            <input type="number" id="auth-age" placeholder="18" min="5" max="100"
                                style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text-main);">
                        </div>
                        <div style="flex: 2;">
                            <label
                                style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem; color: var(--text-dim);">Phone
                                Number</label>
                            <input type="tel" id="auth-phone" placeholder="1234567890"
                                style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text-main);">
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label
                        style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem; color: var(--text-dim);">Email</label>
                    <input type="email" id="auth-email" placeholder="you@example.com" required
                        style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text-main);">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label
                        style="display: block; font-size: 0.85rem; margin-bottom: 0.25rem; color: var(--text-dim);">Password</label>
                    <input type="password" id="auth-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required
                        style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text-main);">
                    <div id="password-hint"
                        style="font-size: 0.75rem; color: var(--text-dim); margin-top: 0.5rem; display: none;">Min 8
                        chars, 1 uppercase, 1 lowercase, 1 number, 1 special char.</div>
                </div>

                <button type="submit" class="gateway-btn primary" id="auth-submit-btn"
                    style="width: 100%;">Login</button>
            </form>

            <div style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--accent); cursor: pointer; text-align: center; font-weight: 500;"
                onclick="app.toggleAuthMode()" id="auth-toggle-text">
                Don't have an account? Sign Up
            </div>
            <button class="ghost-btn" onclick="app.cancelAuth()"
                style="margin-top: 0.5rem; width: 100%; font-size: 0.9rem;">Back</button>
        </div>
    </div>

    <div class="app-shell" style="display: none;" id="app-shell">
        <nav class="sidebar">
            <div class="sidebar-brand">
                <div class="brand-dot"></div>
                <div class="brand-name">Bright Study</div>
            </div>
            <div class="nav-item active" data-target="dashboard" onclick="app.showSection('dashboard')">Dashboard</div>
            <div class="nav-item" data-target="courses" onclick="app.showSection('courses')">Courses</div>

            <div id="online-nav" class="nav-block">
                <div class="nav-label">Online Only</div>
                <div class="nav-item" data-target="aitutor" onclick="app.showSection('aitutor')">AI Tutor</div>
                <div class="nav-item" data-target="scheduler" onclick="app.showSection('scheduler')">Time Table
                    Scheduler</div>
                <div class="nav-item" data-target="more-lessons" onclick="app.showSection('more-lessons')">Add More
                    Lessons</div>
                <div id="video-nav" class="nav-item" data-target="search-videos"
                    onclick="app.showSection('search-videos')" style="display: none;">Search Videos</div>
                <div class="nav-item" data-target="updates" onclick="app.showSection('updates')">Updates</div>
            </div>
            <div class="sidebar-footer" style="display: flex; flex-direction: column; gap: 0.5rem; padding: 1rem;">
                <button class="ghost-btn" onclick="app.resetMode()" style="width: 100%;">Change Mode</button>
                <button class="ghost-btn" onclick="app.resetProgress()"
                    style="width: 100%; color: var(--danger); border-color: rgba(var(--danger-rgb), 0.2); font-size: 0.8rem;">Reset
                    Progress</button>
            </div>
        </nav>

        <main class="main-content">
            <header class="topbar">
                <div>
                    <div class="eyebrow">Learning Path</div>
                    <h2 class="page-title">Stay consistent. Grow steady.</h2>
                </div>
                <div class="topbar-status">
                    <span id="network-status" class="status-badge" style="display: none;"></span>
                    <span class="status-dot"></span>
                    <span class="status-text">Session Ready</span>
                </div>
            </header>

            <section id="dashboard" class="view active">
                <div class="section-head">
                    <h3>My Lessons</h3>
                    <p>Pick a lesson to start a focused, step-by-step flow.</p>
                </div>
                <div id="lesson-grid" class="lesson-grid" style="margin-bottom: 3rem;"></div>

                <div class="section-head">
                    <h3>My Videos</h3>
                    <p>Access your downloaded videos anytime.</p>
                </div>
                <div id="video-grid" class="lesson-grid"></div>
            </section>

            <section id="courses" class="view">
                <!-- Saved Courses -->
                <div class="section-head">
                    <h3>My Saved Courses</h3>
                    <p>Courses you have saved are shown below.</p>
                </div>
                <div id="saved-courses-grid" class="lesson-grid" style="margin-bottom: 3rem;"></div>

                <!-- Search to Save -->
                <div class="section-head"
                    style="display: flex; justify-content: space-between; align-items: flex-end; margin-top: 1rem;">
                    <div>
                        <h3>Find & Save Courses</h3>
                        <p>Search the course database and save courses to your list.</p>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="course-search-input" placeholder="Search courses..."
                            style="padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius); background: var(--surface);">
                        <button id="course-search-btn" class="btn-primary"
                            style="padding: 0.5rem 1rem; border-radius: var(--radius);">Search</button>
                    </div>
                </div>
                <div id="courses-grid" class="lesson-grid" style="margin-bottom: 3rem;"></div>

                <!-- Expanded Course Curriculum View -->
                <div id="course-detail-view"
                    style="display: none; margin-top: 1rem; padding: 1.5rem; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);">
                    <button class="ghost-btn" id="back-to-courses-btn" style="margin-bottom: 1rem;">‚Üê Back to
                        Courses</button>
                    <h3 id="detail-course-title" style="margin-bottom: 0.5rem;"></h3>
                    <p id="detail-course-desc" style="color: var(--text-muted); margin-bottom: 2rem;"></p>
                    <div id="course-curriculum-container" style="display: flex; flex-direction: column; gap: 1rem;">
                        <!-- JS injects Accordions here -->
                    </div>
                </div>
            </section>



            <section id="aitutor" class="view">
                <div class="chat-wrapper">
                    <div class="chat-header-bar">
                        <div class="chat-header-info">
                            <div class="chat-avatar">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M12 2a2 2 0 0 1 2 2c-.001.597-.184 1.163-.523 1.638l.523.522v3.182a4 4 0 0 1-5.184 3.824l-3.328 3.328a2 2 0 0 1-2.828-2.828l3.328-3.328A4 4 0 0 1 10.16 5.16v-3.18l.523-.522A2.001 2.001 0 0 1 12 2Z">
                                    </path>
                                </svg>
                            </div>
                            <div>
                                <h3>AI Assistant</h3>
                                <p class="chat-subtitle">Your personalized learning companion</p>
                            </div>
                        </div>
                        <div class="context-pill">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48" />
                            </svg>
                            <select id="tutor-lesson-select" onchange="app.tutorLessonChanged()">
                                <option value="">No lesson linked</option>
                            </select>
                        </div>
                    </div>

                    <div class="chat-history-container" id="chat-history">
                        <!-- Messages render here -->
                        <div class="chat-welcome">
                            <div class="welcome-icon">üëã</div>
                            <h4>Hello! I'm your AI Tutor.</h4>
                            <p>I can help explain concepts, answer questions, or quiz you on your lessons. Select a
                                lesson context above to get started, or simply ask me anything!</p>
                        </div>
                    </div>

                    <div class="chat-input-wrapper">
                        <div id="file-preview-area" class="file-preview" style="display: none;">
                            <span class="preview-text"></span>
                            <button class="preview-close" onclick="app.removeTutorFile()">√ó</button>
                        </div>
                        <div class="chat-input-row">
                            <label for="tutor-file-upload" class="attach-btn" title="Attach Document (txt, md, csv)">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48" />
                                </svg>
                            </label>
                            <input type="file" id="tutor-file-upload" accept=".txt,.md,.csv" style="display:none;"
                                onchange="app.handleTutorFileUpload(event)" />

                            <textarea id="chat-textarea" placeholder="Message AI Tutor... (Shift+Enter for newline)"
                                onkeypress="app.handleChatKeyPress(event)"></textarea>

                            <button id="chat-send-btn" class="send-btn" onclick="app.sendChatMessage()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="scheduler" class="view">
                <div class="chat-wrapper">
                    <div class="chat-header-bar">
                        <div class="chat-header-info">
                            <div class="chat-avatar" style="background: var(--accent-2);">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#1a1a1a"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </div>
                            <div>
                                <h3>Exam Study Planner</h3>
                                <p class="chat-subtitle">Personalized schedule generator</p>
                            </div>
                        </div>
                    </div>

                    <div class="chat-history-container" id="scheduler-wizard-container">
                        <!-- Questions/Answers will be injected here -->
                        <div class="chat-welcome">
                            <div class="welcome-icon">üìÖ</div>
                            <h4>Exam Season? Let's Plan!</h4>
                            <p>I'll help you generate a perfect study schedule in 5 minutes. Ready to start?</p>
                            <button class="btn-primary" onclick="app.startSchedulerWizard()"
                                style="margin-top: 1rem;">Start Setup Wizard</button>
                        </div>
                    </div>

                    <div id="scheduler-input-area" class="chat-input-wrapper" style="display: none;">
                        <div class="chat-input-row">
                            <div id="scheduler-prompt-label"
                                style="flex: 1; font-size: 0.9rem; color: var(--text-dim); padding: 0.5rem;">Answer the
                                current question below:</div>
                        </div>
                        <div class="chat-input-row" id="scheduler-dynamic-input-container">
                            <!-- Input will be swapped here dynamically (date, text, etc) -->
                            <input type="text" id="scheduler-generic-input"
                                style="flex: 1; padding: 0.75rem; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; color: var(--text-main);">
                            <button class="send-btn" onclick="app.submitSchedulerStep()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="9 11 12 14 22 4"></polyline>
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div id="generated-timetable-area"
                        style="display: none; padding: 1.5rem; overflow-y: auto; max-height: 70vh;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 id="timetable-title">Your Custom Study Plan</h3>
                            <button class="ghost-btn" onclick="app.restartSchedulerWizard()"
                                style="font-size: 0.8rem;">Restart Setup</button>
                        </div>
                        <div id="timetable-grid" class="timetable-grid">
                            <!-- Grid will be rendered here -->
                        </div>
                        <button class="btn-primary" style="width: 100%; margin-top: 1.5rem; padding: 1rem;"
                            onclick="app.saveScheduleToSupabase()">Save Schedule to Cloud</button>
                    </div>
                </div>
            </section>

            <section id="more-lessons" class="view">
                <div class="section-head">
                    <h3>Download Lessons</h3>
                    <p>Search the cloud for new topics when you are online.</p>
                </div>
                <div id="search-section">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Search lesson or concept (e.g. Science)">
                        <button class="btn-primary" onclick="app.searchLessons()">Search</button>
                    </div>
                    <div id="search-results" class="results"></div>
                </div>
            </section>

            <section id="search-videos" class="view">
                <div class="section-head">
                    <h3>Search Videos</h3>
                    <p>Find and download high-quality educational videos.</p>
                </div>
                <div id="video-search-section">
                    <div class="search-box">
                        <input type="text" id="video-search-input"
                            placeholder="Search for videos (e.g. Photosynthesis)">
                        <button class="btn-primary" onclick="app.searchVideos()">Search</button>
                    </div>
                    <div id="video-search-results" class="results"></div>
                </div>
            </section>

            <section id="updates" class="view">
                <div class="section-head">
                    <h3>Content Updates</h3>
                    <p>Apply new packages and confirm what is installed.</p>
                </div>
                <div class="update-panel">
                    <div class="update-header">
                        <div>
                            <div class="update-kicker">Delivery Service</div>
                            <h4>Sync & Apply Content</h4>
                            <p>Run updates when online to keep lessons fresh.</p>
                        </div>
                        <div class="update-actions">
                            <button class="btn-primary" id="applyBtn" type="button">Apply Updates</button>
                            <button class="ghost-btn" id="installedBtn" type="button">Installed Content</button>
                        </div>
                    </div>
                    <div id="updateStatus" class="update-status">Status: idle</div>
                    <div class="update-grid">
                        <div>
                            <div class="update-label">Apply Output</div>
                            <pre id="applyArea">(not run)</pre>
                        </div>
                        <div>
                            <div class="update-label">Installed</div>
                            <ul id="installedList" class="update-list">
                                <li>(unknown)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section id="lesson-player" class="view">
                <div class="classroom-view">
                    <button class="ghost-btn" onclick="app.showSection('dashboard')">Back to Dashboard</button>
                    <div id="concept-ui" class="concept-panel">
                        <div id="concept-step" class="step-chip">STEP 1</div>
                        <h3 id="concept-title">Concept Name</h3>
                        <p id="explanation"></p>
                        <div id="video-container" class="video-container" style="display: none; margin-bottom: 1.5rem;">
                            <video id="lesson-video" controls width="100%" style="border-radius: 8px;"></video>
                        </div>
                        <div class="example-box">
                            <div class="example-title">Example</div>
                            <p id="example-text"></p>
                        </div>
                        <div class="question-block">
                            <p id="question"></p>
                            <input type="text" id="user-answer" placeholder="Your answer">
                            <div id="hint-area"
                                style="display: none; margin: 1rem 0; padding: 0.75rem; background: rgba(var(--accent-rgb), 0.1); border-left: 3px solid var(--accent); border-radius: 4px; font-size: 0.9rem; color: var(--text-main);">
                                <strong>Hint:</strong> <span id="hint-text"></span>
                            </div>
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn-primary" style="flex: 2; padding: 0.7rem;"
                                    onclick="app.checkAnswer()">Submit</button>
                                <button class="ghost-btn" style="flex: 1; font-size: 0.8rem; padding: 0.7rem;"
                                    onclick="app.showDebugAnswer()">Show Answer</button>
                            </div>
                            <div id="feedback" class="feedback"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Course Builder Modal -->
    <div id="course-builder-modal"
        style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; overflow-y: auto; padding: 2rem;">
        <div
            style="max-width: 760px; margin: auto; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;">Add New Course</h2>
                <button class="ghost-btn" onclick="app.closeCourseBuilder()"
                    style="font-size: 1.2rem; padding: 0.25rem 0.75rem;">‚úï</button>
            </div>

            <!-- Course Details -->
            <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1.5rem;">
                <input type="text" id="cb-title" placeholder="Course Title *"
                    style="padding: 0.6rem; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text-main);">
                <textarea id="cb-description" placeholder="Course Description" rows="2"
                    style="padding: 0.6rem; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text-main); resize: vertical;"></textarea>
                <input type="text" id="cb-thumbnail" placeholder="Thumbnail URL (optional)"
                    style="padding: 0.6rem; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text-main);">
            </div>

            <!-- Subjects -->
            <div style="margin-bottom: 1.5rem;">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                    <h3 style="margin: 0;">Subjects</h3>
                    <button class="btn-primary" onclick="app.cb_addSubject()"
                        style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">+ Add Subject</button>
                </div>
                <div id="cb-subjects-container" style="display: flex; flex-direction: column; gap: 1rem;"></div>
            </div>

            <!-- Save/ Error area -->
            <div id="cb-error" style="color: var(--danger); margin-bottom: 0.75rem; display: none;"></div>
            <button class="btn-primary" onclick="app.saveCourse()" style="width: 100%; padding: 0.7rem;">Save Course to
                Database</button>
        </div>
    </div>

    <!-- Adaptive Suggestion Modal -->
    <div id="suggestion-modal" class="overlay" style="display: none;">
        <div class="gateway-card" style="max-width: 450px; text-align: center;">
            <div id="suggestion-icon" style="font-size: 3rem; margin-bottom: 1rem;">üéØ</div>
            <h2 id="suggestion-title">Perfect Match Found!</h2>
            <p id="suggestion-text" style="margin: 1rem 0; color: var(--text-dim); line-height: 1.5;"></p>
            <div class="gateway-actions" style="flex-direction: column; gap: 0.75rem;">
                <button class="gateway-btn primary" id="suggestion-btn" style="width: 100%;">Let's Go!</button>
                <button class="ghost-btn" onclick="app.closeSuggestion()" style="width: 100%;">Maybe Later</button>
            </div>
            <div id="suggestion-downloading"
                style="display: none; margin-top: 1rem; font-size: 0.85rem; color: var(--accent);">
                <div class="spinner-small" style="display: inline-block; vertical-align: middle; margin-right: 0.5rem;">
                </div>
                Downloading lesson...
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>

</html>